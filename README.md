
# Dynamic Pricing Backend

## ТЗ

**Задача:**

* Есть бизнес-структура с товарами, которые продаются в разных ГЕО.
* В каждом ГЕО своя валюта и своя цена (учитывая доставку).
* На каждый товар и ГЕО приходят лиды, которые нужно фиксировать.
* Существует коэффициент, который динамически повышает или понижает цену в зависимости от количества лидов на конкретный ГЕО и товар: больше лидов → меньше цена.
* Рейтинг/коэффициент обновляется каждые 10 минут.
* Необходимо организовать хранение данных и взаимодействие с ними, включая кэширование.

---

## Что реализовано

* **Docker окружение:**

    * PHP/Laravel, MySQL 8, Redis, Nginx.
    * Контейнеры для приложения, базы данных, Redis, очередей и CRON.

* **База данных:**

    * Таблицы: `products`, `geos`, `currencies`, `leads`, `dynamic_prices`.
    * Связь между товарами и ГЕО с учётом валют и доставки.

* **Динамическое ценообразование:**

    * Рассчитывается коэффициент на основе количества лидов для каждого товара в ГЕО.
    * Формула: `больше лидов → цена снижается`.
    * Обновление коэффициентов через CRON каждые 10 минут.

* **Кэширование:**

    * Redis используется для хранения актуальных цен и коэффициентов.
    * Быстрый доступ к ценам без постоянных запросов к MySQL.

* **Очереди и воркеры:**

    * Laravel Queue для обработки задач и событий.
    * Horizon можно подключить для управления очередями (не установлен в текущей версии).

* **Тестирование:**

    * Cache проверяется через `php artisan tinker`.
    * Очереди и логи проверены (`dispatch()` и `queue:work`).

* **CRON / Scheduler:**

    * Скрипт `schedule-cron` выполняет обновление коэффициентов.

* **Логи:**

    * Все действия логируются в `storage/logs/laravel.log`.

---

## Как запустить проект

```bash
docker-compose up -d
docker exec -it dynamic_pricing_app php artisan migrate
docker exec -it dynamic_pricing_app php artisan queue:work
docker exec -it dynamic_pricing_app php artisan tinker
```

---

## Контакты

Автор: Vyacheslav Moiseev
Репозиторий: [https://github.com/vyacheslav-moiseev/m1_backend_developer](https://github.com/vyacheslav-moiseev/m1_backend_developer)
